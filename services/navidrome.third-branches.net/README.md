# `navidrome.third-branches.net`

[Navidrome](https://www.navidrome.org) instance.

## Infrastructure

- App Hosting: Podman
- Reverse Proxy: Cloudflare Tunnel

## How to setup

1. Create directory.
    - `${HOME}/Music`
      - mode: `0755`
    - `${HOME}/.local/share/navidrome`
      - mode: `0755`
2. To access from another device in the initial setting,
    temporarily change the allowed port of the firewall.

    ```shell
    sudo firewall-cmd --zone=public --add-port=4533/tcp
    ```

3. Copy systemd unit files to `${HOME}/.config/containers/systemd/`.
    - `./systemd/navidrome-app.container`
    - `./systemd/navidrome.pod`
4. Enable systemd units.

    ```shell
    systemctl --user daemon-reload
    systemctl --user start navidrome-app.service
    ```

5. Create admin user on Navidrome web ui.
6. Remove allowed port of the firewall on step 2.
7. Delete the allowed port of the firewall that was temporarily added in step 2.

    ```shell
    sudo firewall-cmd --zone=public --remove-port=4533/tcp
    ```

8. Copy systemd unit files to `${HOME}/.config/containers/systemd/`.
    - `./systemd/navidrome-tunnel.container`
      - Set environment `TUNNEL_TOKEN` generated by opentofu.
9. Enable systemd units.

    ```shell
    systemctl --user daemon-reload
    systemctl --user start navidrome-tunnel.service
    ```
